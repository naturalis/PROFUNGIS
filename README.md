# PROFUNGIS
Processing of Fungal ITS Sequences
This pipeline has been created to download SRA studies of fungal ITS markers that will be used to construct a unique set of Z(ero radiance) OTUS to analyse fungal diversity.
## Installing PROFUNGIS
Install before usage:
  - Snakemake
  - BLAST+
  - usearch v11
    - rename the executable file 'usearch11' and place in /deps/ folder
To check if all dependencies are placed correctly, execute the checkDependencies.sh script.

## The PROFUNGIS workflow
PROFUNGIS is divided into three main steps: preprocessing, denoising and postprocessing. In the preprocessing step, the reads corresponding to the provided SRA run id(s) will be downloaded into the ./sample/ directory. Next, the presence of the provided primers in the primer datafile is checked. 
If one or both of the primers are missing, the user is asked to provide the sequence and the part of ITS it amplifies.
Based on the collection of the user-provided parameters, a configuration file is created (config.yml). This file is required by the denoising part of the pipeline. 
The Denoising pipeline follows a mostly basic runthrough of ZOTU
construction. First, the provided primers are cut from both ends of the
reads. If the reads are generated by a paired-end Illumina library, the 
DecideMerger script is called. This step is skipped in pyrosequencing
platforms. The DecideMerger script decides if the paired-end reads
should be merged, or that only the forward reads should be used. If
the library has been sequenced using a pyrosequencing platform
(iontorrent or 454), and the amplicon is a partial ITS sequence
(ITS1 or ITS2), the reads are truncated to 250 bp, to ensure
same treatment. Whether or not the amplicon is a partial ITS
sequences is determined based on the user input primer names.
For every primer, its location relative to ITS is added.

Next, the average Estimated Error (EE) is used using the cor-
responding USEARCH function. If the user has provided the

argument to use a fixed EE, this is used to filter. If not, mean EE
is used to filter the reads. The next step is dereplication of the
reads. After that, singletons are removed and the denoising step
is initiated. This step used the UNOISE3 algorithm to select
biological sequences without clustering based on a fixed identity
percentage. For more information on this step, see section 6.3.
After this step, the reads are remapped to the ZOTUS and a
ZOTU table containing the number of mapped reads is created.
The postprocessing step of the pipeline involves an abundance
filter and a contamination filter. First, the pipeline will use the
ZOTU table to remove all sequences that have less than 0.1% of
the reads in that sample. Next, the contamination filter will use
BLAST to align the ZOTUS to the UNITE database. This is

done to 1) remove putative ZOTUS that are not somewhat sim-
ilar to known ITS sequences and 2) to remove putative ZOTUS

that are not asociated with a fungus. If a ZOTU has a hit with
more than 70% identity and the hit is a fungus, it is retained. If
not, it is removed.
